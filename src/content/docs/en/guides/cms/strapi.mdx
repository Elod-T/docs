---
title: Strapi & Astro
description: Add content to your Astro project using Strapi Headless CMS
type: cms
service: Strapi
stub: false
i18nReady: true
---

import FileTree from '~/components/FileTree.astro';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';

[Strapi](https://strapi.io/) is the next-gen headless CMS, open-source, javascript, enabling content-rich experiences to be created, managed and exposed to any digital device.

## Integrating with Astro

In this section, you will create a wrapper function to connect Strapi with Astro.

### Prerequisites

To get started, you will need to have the following:

1. **An Astro project** - If you don't have an Astro project yet, our [Installation guide](/en/install/auto/) will get you up and running in no time.
2. **A Strapi CMS server** - You need a Strapi server to connect to, you can set one up on a [local environment](https://docs.strapi.io/dev-docs/quick-start)

### Setting up the .env file

To add your Strapi url to Astro, create a `.env` file in the root of your project with the following variable:

```ini title=".env"
STRAPI_URL="http://127.0.0.1:1337"
```

:::tip
In some cases using `STRAPI_URL=http://localhost:1337` will not work, so just to be safe, use the ip address
:::

Now, you should be able to use these environment variables in your project.

If you would like to have IntelliSense for your environment variable, you can create a `env.d.ts` file in the `src/` directory and configure `ImportMetaEnv` like this:

```ts title="src/env.d.ts"
interface ImportMetaEnv {
  readonly STRAPI_URL: string;
}
```

Your root directory should now include the new file(s):

<FileTree title="Project Structure">
  - src/
    - **env.d.ts**
  - **.env**
  - astro.config.mjs
  - package.json
</FileTree>

### Creating the api wrapper

Firstly, you will need create this wrapper function to interact with the Strapi api:

```ts title="lib/strapi.ts"
interface Props {
  endpoint: string;
  query?: Record<string, string>;
  wrappedByKey?: string;
  wrappedByList?: boolean;
}

/**
 * Fetches data from the Strapi API
 * @param endpoint - The endpoint to fetch from
 * @param query - The query parameters to add to the url
 * @param wrappedByKey - The key to unwrap the response from
 * @param wrappedByList - If the response is a list, unwrap it
 * @returns
 */
export default async function fetchApi<T>({
  endpoint,
  query,
  wrappedByKey,
  wrappedByList,
}: Props): Promise<T> {
  if (endpoint.startsWith('/')) {
    endpoint = endpoint.slice(1);
  }

  const url = new URL(`${import.meta.env.STRAPI_URL}/api/${endpoint}`);

  if (query) {
    Object.entries(query).forEach(([key, value]) => {
      url.searchParams.append(key, value);
    });
  }
  const res = await fetch(url.toString());
  let data = await res.json();

  if (wrappedByKey) {
    data = data[wrappedByKey];
  }

  if (wrappedByList) {
    data = data[0];
  }

  return data as T;
}
```

The function requires an object with the following properties:

1. `endpoint` - This is the enpoint you are fetching
2. `query` - The query parameters to add to the end of url
3. `wrappedByKey` - A lot of times when using Strapi, the response is wrapped in an object with the `data` key
4. `wrappedByList` - When you use the filter in Strapi you will get a list back, even if there is only one result. This parameter will unwrap the list and return the first item.

### Optional: Create the interfaces

If you are using typescript you should to create the corresponding interfaces to the Strapi content types. For example create the file `src/interfaces/article.ts` with the content below.

```ts title="src/interfaces/article.ts"
export default interface Article {
  id: number;
  attributes: {
    title: string;
    description: string;
    content: string;
    slug: string;
    createdAt: string;
    updatedAt: string;
    publishedAt: string;
  };
}
```

:::note
Don't forget to modify this interface or even create more to fit your actual needs.
:::

<FileTree title="Project Structure">
  - src/
    - interfaces/
      - **article.ts**
    - lib/
      - strapi.ts
    - env.d.ts
  - .env
  - astro.config.mjs
  - package.json
</FileTree>

### Displaying a list of articles

The page `src/pages/blog/index.astro` displays a list of posts, each with a description and a link to its own page.

<FileTree title="Project Structure">
  - src/
    - interfaces/
      - article.ts
    - lib/
      - strapi.ts
    - pages/
      - **index.astro**
    - env.d.ts
  - .env
  - astro.config.mjs
  - package.json
</FileTree>

Create the `src/pages/blog/index.astro` file. Import the wrapper function, then the interface and fetch the articles. The api returns a list containing the articles. 

```astro title="src/pages/blog/index.astro"
---
import fetchApi from '../../lib/strapi';
import type Article from '../../interfaces/article';

const articles = await fetchApi<Article[]>({
  endpoint: 'articles',
  wrappedByKey: 'data',
});
---
```

The parameters of the `fetchApi` function:

1. The `endpoint` parameter specifies the content type that we want from strapi
2. The `wrappedByKey` specifies to the function to unwrap the api response with `data` key


The api call makes the request to the following url: `http://localhost:1337/api/articles`, and the data will be a list of jsons, similar to the one following:

```
[
  {
    id: 1,
    attributes: {
      title: "What's inside a Black Hole",
      description: 'Maybe the answer is in this article, or not...',
      content: "Well, we don't know yet...",
      slug: 'what-s-inside-a-black-hole',
      createdAt: '2023-05-28T13:19:46.421Z',
      updatedAt: '2023-05-28T13:19:46.421Z',
      publishedAt: '2023-05-28T13:19:45.826Z'
    }
  },
  // ...
]
```

Using the `articles` array returned by the api, display the articles in a list.

```astro title="src/pages/blog/index.astro"
---
import fetchApi from '../../lib/strapi';
import type Article from '../../interfaces/article';

const articles = await fetchApi<Article[]>({
  endpoint: 'articles',
  wrappedByKey: 'data',
});
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Strapi & Astro</title>
  </head>

  <body>
    <main>
      <ul>
        {
          articles.map((article) => (
            <a href={`/blog/${article.attributes.slug}/`}>
              {article.attributes.title}
            </a>
          ))
        }
      </ul>
    </main>
  </body>
</html>
```

### Generating pages

As you may know, there are two methods of rendering in the astro framework: Static page generation and Server-Side Rendering (SSR). Make sure to take a look at the [deployment docs](https://docs.astro.build/en/guides/deploy/) to choose the right one for your situation.

In both cases you need to create the `src/pages/blog/[slug].astro` file.

<FileTree title="Project Structure">
  - src/
    - interfaces/
      - article.ts
    - lib/
      - strapi.ts
    - pages/
      - index.astro
      - blog/
        - **[slug].astro**
    - env.d.ts
  - .env
  - astro.config.mjs
  - package.json
</FileTree>

#### Static site generation

The file `src/pages/post/[slug].astro` [dynamically generates a page](/en/core-concepts/routing/#dynamic-routes) for each article.

Import the wrapper function and the interfaces, then fetch the articles. The api returns a list of articles.

```astro title="src/pages/blog/[slug].astro
---
import fetchApi from '../../lib/strapi';
import type Article from '../../interfaces/article';

export async function getStaticPaths() {
  const articles = await fetchApi<Article[]>({
    endpoint: 'articles',
    wrappedByKey: 'data',
  });

  return articles.map((article) => ({
    params: { slug: article.attributes.slug },
    props: article,
  }));
}
type Props = Article;

const article = Astro.props;
---
```

Create the template for each page using the properties of each post object.


```astro title="src/pages/blog/[slug].astro ins={21-43}
---
import fetchApi from '../../lib/strapi';
import type Article from '../../interfaces/article';

export async function getStaticPaths() {
  const articles = await fetchApi<Article[]>({
    endpoint: 'articles',
    wrappedByKey: 'data',
  });

  return articles.map((article) => ({
    params: { slug: article.attributes.slug },
    props: article,
  }));
}
type Props = Article;

const article = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>{article.attributes.title}</title>
  </head>

  <body>
    <main>
      <img src={import.meta.env.STRAPI_URL + article.attributes.image.data.attributes.url} />

      <h1>{article.attributes.title}</h1>

      <!-- Render plain text -->
      <p>{article.attributes.content}</p>
      <!-- Render markdown -->
      <MyMardownComponent>
        {article.attributes.content}
      </MyMardownComponent>
      <!-- Render html -->
      <Fragment set:html={article.attributes.content} />
    </main>
  </body>
</html>
```
:::tip
Make sure to choose the right rendering for your content. For markdown check out our [markdown guide](/en/guides/markdown-content/). If you are rendering html refer to [this guide](/en/reference/directives-reference/#sethtml) for safety.
:::

#### Server-side rendering

If you've [opted into SSR mode](/en/guides/server-side-rendering/#enabling-ssr-in-your-project), you will use dynamic routes to fetch the page data from Strapi.

:::tip
For the time of development add the `output: "server"` property to the `astro.config.mjs` file to enable SSR mode.
:::

Create the `src/pages/blog/[slug].astro` file:

```astro title="src/pages/blog/[slug].astro"
---
import fetchApi from '../../../lib/strapi';
import type Article from '../../../interfaces/article';

const { slug } = Astro.params;

let article: Article;

try {
  article = await fetchApi<Article>({
    endpoint: 'articles',
    wrappedByKey: 'data',
    wrappedByList: true,
    query: {
      'filters[slug][$eq]': slug || '',
    },
  });
} catch (error) {
  return Astro.redirect('/404');
}
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>{article.attributes.title}</title>
  </head>

  <body>
    <main>
      <img src={import.meta.env.STRAPI_URL + article.attributes.image.data.attributes.url} />

      <h1>{article.attributes.title}</h1>

      <!-- Render plain text -->
      <p>{article.attributes.content}</p>
      <!-- Render markdown -->
      <MyMardownComponent>
        {article.attributes.content}
      </MyMardownComponent>
      <!-- Render html -->
      <Fragment set:html={article.attributes.content} />
    </main>
  </body>
</html>
```

:::tip
Make sure to choose the right rendering for your content. For markdown check out our [markdown guide](/en/guides/markdown-content/). If you are rendering html refer to [this guide](/en/reference/directives-reference/#sethtml) for safety.
:::

This file will fetch and render the page data from Strapi that matches the dynamic `slug` parameter.

Since you are using a redirect to `/404`, create a 404 page in `src/pages`:

```astro title="src/pages/404.astro"
<html lang="en">
  <head>
    <title>Not found</title>
  </head>
  <body>
    <p>Sorry, this page does not exist.</p>
    <img src="https://http.cat/404" />
  </body>
</html>
```

If the article is not found, the user will be redirected to this 404 page and greeted by a lovely cat.

### Publishing your site

To deploy your website, visit our [deployment guides](/en/guides/deploy/) and follow the instructions for your preferred hosting provider.

#### Rebuild on changes

If your project is using Astro's default static mode, you will need to set up a webhook to trigger a new build when your content changes. If you are using Netlify or Vercel as your hosting provider, you can use its webhook feature to trigger a new build from Strapi.

##### Netlify

To set up a webhook in Netlify:

1. Go to your site dashboard and click on **Build & deploy**.

2. Under the **Continuous Deployment** tab, find the **Build hooks** section and click on **Add build hook**.

3. Provide a name for your webhook and select the branch you want to trigger the build on. Click on **Save** and copy the generated URL.

##### Vercel

To set up a webhook in Vercel:

1. Go to your project dashboard and click on **Settings**.

2. Under the **Git** tab, find the **Deploy Hooks** section.

3. Provide a name for your webhook and the branch you want to trigger the build on. Click **Add** and copy the generated URL.

##### Adding a webhook to Strapi

Follow this [guide](https://strapi.io/blog/webhooks) to create a webhook in your Strapi admin panel.

## Official Resources

- [Strapi Blog Guide For React](https://strapi.io/blog/build-a-blog-with-next-react-js-strapi) by Strapi
